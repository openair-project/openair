<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate percentile values from a time series ‚Äî calcPercentile ‚Ä¢ openair</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Nunito_Sans-0.4.9/font.css" rel="stylesheet"><link href="../deps/JetBrains_Mono-0.4.9/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate percentile values from a time series ‚Äî calcPercentile"><meta name="description" content="Calculates multiple percentile values from a time series, with flexible time
aggregation. This function is a wrapper for timeAverage(), making it easier
to calculate several percentiles at once. Like timeAverage(), it requires a
data frame with a date field and one other numeric variable."><meta property="og:description" content="Calculates multiple percentile values from a time series, with flexible time
aggregation. This function is a wrapper for timeAverage(), making it easier
to calculate several percentiles at once. Like timeAverage(), it requires a
data frame with a date field and one other numeric variable."><meta property="og:image" content="https://openair-project.github.io/openair/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">openair</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.18.2.9009</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/openair.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/openair-project" aria-label="Website"><span class="fa fa-globe"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://openair-project.github.io/book/" aria-label="Book"><span class="fa fa-book"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/openair-project/openair/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-packages" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Packages</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-packages"><li><a class="dropdown-item" href="https://openair-project.github.io/openair/">üß≠ openair</a></li>
    <li><a class="dropdown-item" href="https://openair-project.github.io/openairmaps/">üó∫Ô∏è openairmaps</a></li>
    <li><a class="external-link dropdown-item" href="https://openair-project.github.io/worldmet/">üçÉ worldmet</a></li>
    <li><a class="external-link dropdown-item" href="https://openair-project.github.io/deweather/">üìâ deweather</a></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Calculate percentile values from a time series</h1>
      <small class="dont-index">Source: <a href="https://github.com/openair-project/openair/blob/master/R/calcPercentile.R" class="external-link"><code>R/calcPercentile.R</code></a></small>
      <div class="d-none name"><code>calcPercentile.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calculates multiple percentile values from a time series, with flexible time
aggregation. This function is a wrapper for <code><a href="timeAverage.html">timeAverage()</a></code>, making it easier
to calculate several percentiles at once. Like <code><a href="timeAverage.html">timeAverage()</a></code>, it requires a
data frame with a <code>date</code> field and one other numeric variable.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">calcPercentile</span><span class="op">(</span></span>
<span>  <span class="va">mydata</span>,</span>
<span>  pollutant <span class="op">=</span> <span class="st">"o3"</span>,</span>
<span>  avg.time <span class="op">=</span> <span class="st">"month"</span>,</span>
<span>  percentile <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"default"</span>,</span>
<span>  data.thresh <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  start.date <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  end.date <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  prefix <span class="op">=</span> <span class="st">"percentile."</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-mydata">mydata<a class="anchor" aria-label="anchor" href="#arg-mydata"></a></dt>
<dd><p>A data frame containing a <code>date</code> field . Can be class <code>POSIXct</code>
or <code>Date</code>.</p></dd>


<dt id="arg-pollutant">pollutant<a class="anchor" aria-label="anchor" href="#arg-pollutant"></a></dt>
<dd><p>Name of column containing variable to summarise, likely a
pollutant (e.g., <code>"o3"</code>).</p></dd>


<dt id="arg-avg-time">avg.time<a class="anchor" aria-label="anchor" href="#arg-avg-time"></a></dt>
<dd><p>This defines the time period to average to. Can be <code>"sec"</code>,
<code>"min"</code>, <code>"hour"</code>, <code>"day"</code>, <code>"DSTday"</code>, <code>"week"</code>, <code>"month"</code>, <code>"quarter"</code> or
<code>"year"</code>. For much increased flexibility a number can precede these options
followed by a space. For example, a timeAverage of 2 months would be
<code>period = "2 month"</code>. In addition, <code>avg.time</code> can equal <code>"season"</code>, in
which case 3-month seasonal values are calculated with spring defined as
March, April, May and so on.</p>
<p>Note that <code>avg.time</code> can be <em>less</em> than the time interval of the original
series, in which case the series is expanded to the new time interval. This
is useful, for example, for calculating a 15-minute time series from an
hourly one where an hourly value is repeated for each new 15-minute period.
Note that when expanding data in this way it is necessary to ensure that
the time interval of the original series is an exact multiple of <code>avg.time</code>
e.g. hour to 10 minutes, day to hour. Also, the input time series must have
consistent time gaps between successive intervals so that <code><a href="timeAverage.html">timeAverage()</a></code>
can work out how much 'padding' to apply. To pad-out data in this way
choose <code>fill = TRUE</code>.</p></dd>


<dt id="arg-percentile">percentile<a class="anchor" aria-label="anchor" href="#arg-percentile"></a></dt>
<dd><p>A vector of percentile values; for example, <code>percentile = 50</code> will calculate median values. Multiple values may also be provided as a
vector, e.g., <code>percentile = c(5, 50, 95)</code> or <code>percentile = seq(0, 100, 10)</code>.</p></dd>


<dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p><code>type</code> allows <code><a href="timeAverage.html">timeAverage()</a></code> to be applied to cases where there
are groups of data that need to be split and the function applied to each
group. The most common example is data with multiple sites identified with
a column representing site name e.g. <code>type = "site"</code>. More generally,
<code>type</code> should be used where the date repeats for a particular grouping
variable. However, if type is not supplied the data will still be averaged
but the grouping variables (character or factor) will be dropped.</p></dd>


<dt id="arg-data-thresh">data.thresh<a class="anchor" aria-label="anchor" href="#arg-data-thresh"></a></dt>
<dd><p>The data capture threshold to use (%). A value of zero
means that all available data will be used in a particular period
regardless if of the number of values available. Conversely, a value of 100
will mean that all data will need to be present for the average to be
calculated, else it is recorded as <code>NA</code>. See also <code>interval</code>, <code>start.date</code>
and <code>end.date</code> to see whether it is advisable to set these other options.</p></dd>


<dt id="arg-start-date">start.date<a class="anchor" aria-label="anchor" href="#arg-start-date"></a></dt>
<dd><p>A string giving a start date to use. This is sometimes
useful if a time series starts between obvious intervals. For example, for
a 1-minute time series that starts <code>2009-11-29 12:07:00</code> that needs to be
averaged up to 15-minute means, the intervals would be <code>2009-11-29 12:07:00</code>, <code>2009-11-29 12:22:00</code>, etc. Often, however, it is better to
round down to a more obvious start point, e.g., <code>2009-11-29 12:00:00</code> such
that the sequence is then <code>2009-11-29 12:00:00</code>, <code>2009-11-29 12:15:00</code>, and
so on. <code>start.date</code> is therefore used to force this type of sequence.</p></dd>


<dt id="arg-end-date">end.date<a class="anchor" aria-label="anchor" href="#arg-end-date"></a></dt>
<dd><p>A string giving an end date to use. This is sometimes useful
to make sure a time series extends to a known end point and is useful when
<code>data.thresh &gt; 0</code> but the input time series does not extend up to the final
full interval. For example, if a time series ends sometime in October but
annual means are required with a data capture of &gt;75 % then it is necessary
to extend the time series up until the end of the year. Input in the format
yyyy-mm-dd HH:MM.</p></dd>


<dt id="arg-prefix">prefix<a class="anchor" aria-label="anchor" href="#arg-prefix"></a></dt>
<dd><p>Each new column is named by appending a <code>prefix</code> to
<code>percentile</code>. For example, the default <code>"percentile."</code> will name the new
column as <code>percentile.95</code> when <code>percentile = 95</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Returns a <code>data.frame</code> with a <code>date</code> column plus an additional
column for each given <code>percentile</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="timePlot.html">timePlot()</a></code>, <code><a href="timeAverage.html">timeAverage()</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>David Carslaw</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># 95th percentile monthly o3 concentrations</span></span></span>
<span class="r-in"><span><span class="va">percentiles</span> <span class="op">&lt;-</span> <span class="fu">calcPercentile</span><span class="op">(</span><span class="va">mydata</span>,</span></span>
<span class="r-in"><span>  pollutant <span class="op">=</span> <span class="st">"o3"</span>,</span></span>
<span class="r-in"><span>  avg.time <span class="op">=</span> <span class="st">"month"</span>, percentile <span class="op">=</span> <span class="fl">95</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">percentiles</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 6 √ó 2</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   date                percentile.95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>                      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> 1998-01-01 <span style="color: #949494;">00:00:00</span>            14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> 1998-02-01 <span style="color: #949494;">00:00:00</span>             7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span> 1998-03-01 <span style="color: #949494;">00:00:00</span>            15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span> 1998-04-01 <span style="color: #949494;">00:00:00</span>            20</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span> 1998-05-01 <span style="color: #949494;">00:00:00</span>            25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">6</span> 1998-06-01 <span style="color: #949494;">00:00:00</span>            15</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 5, 50, 95th percentile monthly o3 concentrations</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">percentiles</span> <span class="op">&lt;-</span> <span class="fu">calcPercentile</span><span class="op">(</span><span class="va">mydata</span>,</span></span>
<span class="r-in"><span>  pollutant <span class="op">=</span> <span class="st">"o3"</span>,</span></span>
<span class="r-in"><span>  avg.time <span class="op">=</span> <span class="st">"month"</span>, percentile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">50</span>, <span class="fl">95</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">percentiles</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by David Carslaw, Jack Davison, Karl Ropkins.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

